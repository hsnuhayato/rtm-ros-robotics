<launch>
  <arg name="ROBOT_NAME" />
  <arg name="MODEL_FILE" />
  <arg name="COLLADA_FILE" />
  <arg name="SIMULATOR_NAME" default="$(arg ROBOT_NAME)(Robot)0"/>
  <arg name="INSTALL_ROBOT_DESCRIPTION" default="true" />
  <!--
      roslaunch hrpsys_ros_bridge sample.launch nameserver:=192.168.1.1
  -->
  <!-- BEGIN:openrtm setting -->
  <arg name="nameserver" default="localhost" />
  <env name="RTCTREE_NAMESERVERS" value="$(arg nameserver)" />
  <arg name="openrtm_args" value='-o "corba.nameservers:$(arg nameserver):2809" -o "naming.formats:%n.rtc" -o "manager.modules.load_path:$(find hrpsys)/lib" -o "manager.modules.preload:hrpEC.so" -o "exec_cxt.periodic.type:hrpExecutionContext" -o "exec_cxt.periodic.rate:2000" -o "logger.file_name:/tmp/rtc%p.log"' />
  <!-- END:openrtm setting -->
  <arg name="OUTPUT" default="screen"/>
  <env name="LANG" value="C" />
  <env name="ORBgiopMaxMsgSize" value="2147483648" />

  <node name = "HrpsysSeqStateROSBridge"
        pkg  = "hrpsys_ros_bridge"
        type = "HrpsysSeqStateROSBridge"
        args = "$(arg openrtm_args) -o model:$(arg MODEL_FILE)"
        output = "$(arg OUTPUT)" />
  <node name = "HrpsysJointTrajectoryBridge"
        pkg  = "hrpsys_ros_bridge"
        type = "HrpsysJointTrajectoryBridge"
        args = "$(arg openrtm_args) -o model:$(arg MODEL_FILE)"
        output = "$(arg OUTPUT)" />
  <node pkg="hrpsys_ros_bridge" name="ImageSensorROSBridge" type="ImageSensorROSBridge"
        output="$(arg OUTPUT)" args="$(arg openrtm_args)" >
    <param name="frame_id" value="/VISION_SENSOR1" />
  </node>
  <node pkg="hrpsys" name="DataLoggerServiceROSBridge" type="DataLoggerServiceROSBridgeComp"
        output="$(arg OUTPUT)" args="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="ImpedanceControllerServiceROSBridge" type="ImpedanceControllerServiceROSBridgeComp"
        output="screen" args ="$(arg openrtm_args)" />
  <!-- -o "exec_cxt.periodic.type:SynchExtTriggerEC" -->
  <node pkg="hrpsys" name="SequencePlayerServiceROSBridge" type="SequencePlayerServiceROSBridgeComp"
        output="$(arg OUTPUT)" args="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="CollisionDetectorServiceROSBridge" type="CollisionDetectorServiceROSBridgeComp"
        output="$(arg OUTPUT)" args="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="AutoBalancerServiceROSBridge" type="AutoBalancerServiceROSBridgeComp"
        output="screen" args ="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="StateHolderServiceROSBridge" type="StateHolderServiceROSBridgeComp"
        output="screen" args ="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="RobotHardwareServiceROSBridge" type="RobotHardwareServiceROSBridgeComp"
        output="screen" args ="$(arg openrtm_args)" />
  <node pkg="hrpsys" name="SoftErrorLimiterServiceROSBridge" type="SoftErrorLimiterServiceROSBridgeComp"
        output="screen" args ="$(arg openrtm_args)" />

  <group if="$(arg INSTALL_ROBOT_DESCRIPTION)" >
    <param name="robot_description" textfile="$(arg COLLADA_FILE)" />
    <node pkg="robot_state_publisher" type="state_publisher" name="hrpsys_state_publisher" />
  </group>

  <!-- diagnostics -->
  <moge>
  <node pkg="hrpsys_ros_bridge" name="hrpsys_ros_diagnostics" type="diagnostics.py" />
  <node pkg="hrpsys_ros_bridge" name="hrpsys_profile" type="hrpsys_profile.py" />
  <node pkg="diagnostic_aggregator" type="aggregator_node" name="diagnostic_aggregator" >
    <rosparam command="load" file="$(find hrpsys_ros_bridge)/scripts/diagnostics.yaml" />
  </node>
  </moge>
  <node pkg="hrpsys_ros_bridge" name="sensor_ros_bridge_connect" type="sensor_ros_bridge_connect.py"
        args="$(arg MODEL_FILE) $(arg SIMULATOR_NAME) HrpsysSeqStateROSBridge0" output="$(arg OUTPUT)"/>

  <!-- BEGIN:openrtm connection -->
  <env name="ROBOT_NAME" value="$(arg ROBOT_NAME)" />
  <env name="SIMULATOR_NAME" value="$(arg SIMULATOR_NAME)" />
  <node name="rtmlaunch_hrpsys_ros_bridge" pkg="openrtm" type="rtmlaunch.py" args="$(find hrpsys_ros_bridge)/launch/hrpsys_ros_bridge.launch"/>
  <rtconnect from="$(arg SIMULATOR_NAME).rtc:q" to="HrpsysSeqStateROSBridge0.rtc:rsangle" subscription_type="new"/>
  <rtconnect from="$(arg SIMULATOR_NAME).rtc:tau" to="HrpsysSeqStateROSBridge0.rtc:rstorque" subscription_type="new"/>
  <rtconnect from="sh.rtc:baseTformOut" to="HrpsysSeqStateROSBridge0.rtc:baseTform" subscription_type="new"/>
  <rtconnect from="$(arg SIMULATOR_NAME).rtc:rate" to="kf.rtc:rate" subscription_type="new"/>
  <rtconnect from="$(arg SIMULATOR_NAME).rtc:acc" to="kf.rtc:acc" subscription_type="new"/>
  <rtconnect from="kf.rtc:rpy" to="HrpsysSeqStateROSBridge0.rtc:baseRpy" subscription_type="new"/>
  <rtconnect from="HrpsysSeqStateROSBridge0.rtc:SequencePlayerService" to="seq.rtc:SequencePlayerService" subscription_type="new"/>
  <rtconnect from="HrpsysJointTrajectoryBridge0.rtc:SequencePlayerService" to="seq.rtc:SequencePlayerService" subscription_type="new"/>
  <!-- <rtconnect from="$(arg ROBOT_NAME)(Robot)0.rtc:left-eye" to="ImageSensorROSBridge0.rtc:image" /> -->
  <rtconnect from="DataLoggerServiceROSBridge.rtc:DataLoggerService" to="log.rtc:DataLoggerService" subscription_type="new"/>
  <rtconnect from="SequencePlayerServiceROSBridge.rtc:SequencePlayerService" to="seq.rtc:SequencePlayerService" subscription_type="new"/>
  <rtconnect from="ImpedanceControllerServiceROSBridge.rtc:ImpedanceControllerService" to="ic.rtc:ImpedanceControllerService"  subscription_type="new"/>
  <rtconnect from="AutoBalancerServiceROSBridge.rtc:AutoBalancerService" to="abc.rtc:AutoBalancerService"  subscription_type="new"/>
  <rtconnect from="CollisionDetectorServiceROSBridge.rtc:CollisionDetectorService" to="co.rtc:CollisionDetectorService" subscription_type="new"/>
  <rtconnect from="StateHolderServiceROSBridge.rtc:StateHolderService" to="sh.rtc:StateHolderService"  subscription_type="new"/>
  <rtconnect from="RobotHardwareServiceROSBridge.rtc:RobotHardwareService" to="$(arg SIMULATOR_NAME).rtc:RobotHardwareService"  subscription_type="new"/>
  <rtconnect from="SoftErrorLimiterServiceROSBridge.rtc:SoftErrorLimiterService" to="el.rtc:SoftErrorLimiterService"  subscription_type="new"/>
  <rtactivate component="HrpsysSeqStateROSBridge0.rtc" />
  <rtactivate component="HrpsysJointTrajectoryBridge0.rtc" />
  <rtactivate component="ImageSensorROSBridge0.rtc" />
  <rtactivate component="DataLoggerServiceROSBridge.rtc" />
  <rtactivate component="SequencePlayerServiceROSBridge.rtc" />
  <rtactivate component="CollisionDetectorServiceROSBridge.rtc" />
  <rtactivate component="ImpedanceControllerServiceROSBridge.rtc" />
  <rtactivate component="AutoBalancerServiceROSBridge.rtc" />
  <rtactivate component="StateHolderServiceROSBridge.rtc" />
  <rtactivate component="RobotHardwareServiceROSBridge.rtc" />
  <rtactivate component="SoftErrorLimiterServiceROSBridge.rtc" />
  <!-- END:openrtm connection -->
</launch>

