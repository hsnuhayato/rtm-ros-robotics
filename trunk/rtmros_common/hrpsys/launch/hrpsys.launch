<?xml version="1.0" encoding="utf-8"?>
<launch>
  <!-- BEGIN:openrtm setting -->
  <arg name="nameserver" default="localhost" />
  <env name="RTCTREE_NAMESERVERS" value="$(arg nameserver)" />
  <arg name="openrtm_args" value='-o "corba.nameservers:$(arg nameserver):2809" -o "naming.formats:%n.rtc" -o "logger.file_name:/tmp/rtc%p.log" ' />
  <!-- END:openrtm setting -->
  <arg name="PROJECT_FILE" />
  <arg name="MODEL_FILE" />
  <arg name="CONF_FILE" />
  <arg name="RESPAWN" default="true"/>
  <arg name="OUTPUT" default="log"/>
  <arg name="SIMULATOR_NAME" default="Simulator"/>
  <arg name="HRPSYS_PERIODIC_RATE" default="200"/>
  <arg name="OPENHRP3_SIM_PERIODIC_RATE" default="200"/>
  <arg name="KINEMATICS_ONLY" default="false"/>
  <env name="LANG" value="C" />
  <env name="ORBgiopMaxMsgSize" value="2147483648" />

  <node name="rtm_naming" pkg="openrtm" type="rtm-naming-restart" />

  <node name="hrpsys_kill_all" pkg="openhrp3" type="openhrp-shutdown-servers" />

  <node name="viewer" pkg="hrpsys" type="ViewerComp" args='$(arg openrtm_args) -o "example.Viewer0.conf.default.project:$(arg PROJECT_FILE)" -o "exec_cxt.periodic.rate:30"' />
  <node name="simulator" pkg="hrpsys" type="SimulatorComp" args='$(arg openrtm_args) -o "example.Simulator.instance_name:$(arg SIMULATOR_NAME)" -o "example.Simulator.conf.default.project:$(arg PROJECT_FILE)" -o "example.Simulator.conf.default.kinematics_only:$(arg KINEMATICS_ONLY)" -o "exec_cxt.periodic.rate:$(arg OPENHRP3_SIM_PERIODIC_RATE)"' respawn="$(arg RESPAWN)" />

  <node name="modelloader" pkg="openhrp3" type="openhrp-model-loader" respawn="$(arg RESPAWN)" /> <!-- loading dae files crushes model loader -->

  <node name="rtcd" pkg="openrtm" type="rtcd" output="$(arg OUTPUT)"
	args='$(arg openrtm_args) -o "exec_cxt.periodic.rate:$(arg HRPSYS_PERIODIC_RATE)" -o "manager.shutdown_onrtcs:NO" -o "manager.is_master:YES" -o "manager.modules.load_path:$(find hrpsys)/lib" -o "example.SequencePlayer.config_file:$(arg CONF_FILE)"' />

  <!-- node name="rtcgraph" pkg="openrtm" type="rtcgraph" output="screen"/ -->
  <node name="hrpsys" pkg="hrpsys" type="hrpsyspy" output="screen"
	args='$(find hrpsys)/scripts/hrpsys.py $(arg SIMULATOR_NAME)' />

  <node name="abstransform2posrpy" pkg="hrpsys" type="AbsTransformToPosRpy" output="$(arg OUTPUT)"
	args="$(arg openrtm_args)" respawn="$(arg RESPAWN)" />

  <!-- BEGIN:openrtm connection -->
  <arg name="ROBOT_NAME" value="dummy" />
  <node name="rtmlaunch_hrpsys" pkg="hrpsys" type="hrpsys-launch.sh" args="$(arg MODEL_FILE) $(find hrpsys)/launch/hrpsys.launch" respawn="$(arg RESPAWN)" />
  <rtactivate component="Viewer0.rtc" />
  <rtconnect from="$(arg SIMULATOR_NAME).rtc:state" to="Viewer0.rtc:state" />
  <!-- END:openrtm connection -->
</launch>
