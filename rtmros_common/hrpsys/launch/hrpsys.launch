<?xml version="1.0" encoding="utf-8"?>
<launch>
  <!-- BEGIN:openrtm setting -->
  <arg name="nameserver" default="localhost" />
  <arg name="KILL_SERVERS" default="false" />
  <env name="RTCTREE_NAMESERVERS" value="$(arg nameserver)" />
  <arg name="openrtm_args" value='-o "corba.nameservers:$(arg nameserver):2809" -o "naming.formats:%n.rtc" -o "logger.file_name:/tmp/rtc%p.log" ' />
  <!-- END:openrtm setting -->
  <arg name="PROJECT_FILE" />
  <arg name="MODEL_FILE" />
  <arg name="CONF_FILE" />
  <arg name="RESPAWN" default="true"/>
  <arg name="OUTPUT" default="log"/>
  <arg name="SIMULATOR_NAME" default="Simulator"/>
  <arg name="HRPSYS_PERIODIC_RATE" default="200"/>
  <arg name="OPENHRP3_SIM_PERIODIC_RATE" default="200"/>
  <arg name="KINEMATICS_ONLY" default="0"/>
  <env name="LANG" value="C" />
  <env name="ORBgiopMaxMsgSize" value="2147483648" />

  <node name="rtm_naming" pkg="openrtm" type="rtm-naming-restart" />

  <group if="$(arg KILL_SERVERS)">
    <node name="hrpsys_kill_all" pkg="openhrp3" type="openhrp-shutdown-servers" />
  </group>

  <node name="modelloader" pkg="openhrp3" type="openhrp-model-loader" respawn="$(arg RESPAWN)" /> <!-- loading dae files crushes model loader -->

  <node name="rtcd" pkg="hrpsys" type="hrpsys-simulator" output="$(arg OUTPUT)"
	args='$(arg PROJECT_FILE) $(arg openrtm_args) -o "exec_cxt.periodic.rate:$(arg HRPSYS_PERIODIC_RATE)" -o "manager.shutdown_onrtcs:NO" -o "manager.is_master:YES" -o "manager.modules.load_path:$(find hrpsys)/lib" -o "manager.modules.preload:HGcontroller.so" -o "manager.components.precreate:HGcontroller" -o "exec_cxt.periodic.type:SynchExtTriggerEC" -o "example.SequencePlayer.config_file:$(arg CONF_FILE)"' />

  <!-- node name="rtcgraph" pkg="openrtm" type="rtcgraph" output="screen"/ -->
  <node name="hrpsys" pkg="hrpsys" type="hrpsyspy" output="screen"
	args='$(find hrpsys)/scripts/hrpsys.py $(arg SIMULATOR_NAME) $(arg MODEL_FILE)' />

  <node name="abstransform2posrpy" pkg="hrpsys" type="AbsTransformToPosRpy" output="$(arg OUTPUT)"
	args="$(arg openrtm_args)" respawn="$(arg RESPAWN)" />

  <!-- BEGIN:openrtm connection -->
  <arg name="ROBOT_NAME" value="dummy" />
  <env name="SIMULATOR_NAME" value="$(arg SIMULATOR_NAME)"/>
  <node name="rtmlaunch_hrpsys" pkg="hrpsys" type="hrpsys-launch.sh" args="$(arg MODEL_FILE) $(find hrpsys)/launch/hrpsys.launch" respawn="$(arg RESPAWN)" />
  <!-- END:openrtm connection -->
</launch>
