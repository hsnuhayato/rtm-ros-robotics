#summary rosportを試す

= 概要 =

rosportとは，産総研のジェフさんが開発，公式ページで公開しているros/rtm相互運用のための仕組みである．

RTM側のソースで通常のデータポート，サービスポートと同様の書き方で，ROS側へのtopicのpublish，ROS側からのtopicのsubscribeなどが行える．

詳細は，
http://www.openrtm.org/openrtm/ja/content/ros%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%83%9D%E3%83%BC%E3%83%88rosport

にあるが，現在公式ページで配布しているのはcturtle用なので，ここではdiamondback用のパッチを当てて試す方法を解説する．

= 準備 =

試すには，OpenRTM-aistのソースにパッチを当てて，コンパイルし直す必要がある．
まず，バイナリでインストールしている場合には，アンインストールしておくこと．

{{{
$ sudo apt-get remove openrtm-aist openrtm-aist-dev openrtm-aist-example
}}}

次に，パッチとセットアップスクリプトがrtmeus/tools以下にあるので，予めrtmeusを
チェックアウトしておくこと．方法はrtmeus/roseus相互接続のページに書いてある．

{{{
$ cd 
}}}

= 使い方 =

例えば，ROS側にpublishしたい場合，ヘッダファイルの中で

{{{
#include <rtm/RosOutPort.h>
RosOutPort<numbers::Num> _numOut;
}}}

のように定義して，cpp側は，
{{{
RTC::ReturnCode_t Publisher::onInitialize()
{
    addRosOutPort("number", _numOut);
    return RTC::RTC_OK;
}

RTC::ReturnCode_t Publisher::onExecute(RTC::UniqueId ec_id)                     
{                                                                               
    _num.num += 1;                                                              
    _numOut.write();                                                            
    std::cout << "Wrote " << _num.num << std::endl;                             
    return RTC::RTC_OK;                                                         
}
}}}

　 
というようにすれば，RTCからnumberというトピックをpublishすることができる．

= サンプル =

ジェフさんが作って公開しているサンプルが

http://www.google.co.jp/gwt/x?source=m&u=http%3A%2F%2Fwww.openrtm.org/pub/OpenRTM-aist/cxx/1.0.0/examples.ros-1.0.0.tar.gz&wsi=7847c037bb64cc19&ei=hQIDTqYal8ewBu783PsE&wsc=bk

にあるので，これを試すのが良い．