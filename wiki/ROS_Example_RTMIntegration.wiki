#summary RTM-ROS Integration

<wiki:toc max_depth="2" />

* これまでの演習に参加していない人はリポジトリのインストールをしてください
{{{
$ rosinstall ~/prog/rtm-ros-robotics /opt/ros/diamondback http://rtm-ros-robotics.googlecode.com/svn/trunk/agentsystem_ros_tutorials/rtm-ros-robotics.rosinstall
}}}

* 自分のつかっているUbuntuのバージョンを調べて下さい．
{{{
$ lsb_release -a
}}}
です．10.04か10.10であることが期待されています．

10.04の人は，
http://code.google.com/p/rtm-ros-robotics/wiki/RTM_Install
にある通り，ipv6の設定によりlocalhostという名前解決ができないことがあるため，その場合，root権限で/etc/hostsの5行目をコメントアウトする．即ち，
{{{
::1     localhost ip6-localhost ip6-loopback   
}}}
を
{{{
#::1     localhost ip6-localhost ip6-loopback  
}}}
と変更して保存する．Makefileでチェックしているので，変更していないとMakeが通らない．

= 1.OpenHRP 環境の構築 =

== Java の確認 ==
{{{
$ rosdep install openhrp3
$ java -version
}}}
としたときに、
{{{
java version "1.6.0_24"
Java(TM) SE Runtime Environment (build 1.6.0_24-b07)
Java HotSpot(TM) 64-Bit Server VM (build 19.1-b02, mixed mode)
}}}
という風にJava(TM) SE が出ている必要があります．
この文字列が出てこない場合は、
{{{
$ sudo update-java-alternatives -s java-6-sun
}}}
とする

== 旧バージョンOpenRTMの確認(インストールしたことがある人限定) ==
{{{
rtm-config --version
}}}
とうって
{{{
0.4.2
}}}
と出た人は，古いOpenRTMが入っているので
{{{
cd /usr/local/src/OpenRTM/OpenRTM-aist-0.4.2
sudo make uninstall
}}}
としてください

== OpenHRPのコンパイル ==

{{{
rosmake rtmros_common
}}}

もしopenhrp3のMakeが通らないときは
{{{
roscd openhrp3;make wipe
make
}}}

= 2.Eclipseの設定 =

<wiki:video url="http://www.youtube.com/watch?v=Majjva2YhX4" />

== 外部プラグインのインストール for RT System Editor ==
{{{
rosrun openhrp3 eclipse.sh
}}}
で立ち上がるeclipseを用いる

 Help -> Install New Softare -> Add -> Location
に
(10.04ユーザのみ）
http://download.eclipse.org/modeling/emf/updates/releases/
を追加し、EMF SDK 2.5.0 を選択しインストール.

(10.04/10.10ユーザ共通)
http://download.eclipse.org/tools/gef/updates/releases/
を追加し、GEF SDK 3.6.2をS選択しインストール．

ここまででRT System Editorが入る
{{{
rosrun openhrp3 eclipse.sh
}}}
でEclipseを立ち上げて、
 Window -> Open Perspective -> Other 
で、RT System Editorが入っていることが確認できる

== 外部プラグイン並びにのJava環境のインストール for GRXUI ==

(10.04/10.10ユーザ共通)
http://sourceforge.net/projects/java3d-eclipse/files/
から[http://downloads.sourceforge.net/project/java3d-eclipse/java3declipse%20plugin/20090302/java3declipse-20090302.zip?r=http%3A%2F%2Fsourceforge.net%2Fprojects%2Fjava3d-eclipse%2Ffiles%2F&ts=1307526535&use_mirror=jaist java3declipse-20090302.zip]をダウンロードし、
Help -> Install New Softare -> Add -> Archive
で、ダウンロードしたzipを選択、すべてを選択し、インストールする。

ダウンロードしたzipを選択する際のパスに日本語が含まれる（デスクトップなど）と、
MESSAGE No repository found
と認識されないので、例えば/tmpにダウンロードするなどパスはすべて英数字になるところにする

{{{
rosrun openhrp3 eclipse.sh
}}}
でEclipseを立ち上げて、
 Window -> Open Perspective -> Other 
で、GRXUIが入っていることを確認する。

= 3.動作確認 =
<wiki:video url="http://www.youtube.com/watch?v=6wEH-41rw74" />

== RT System Editor 動作確認 ==
以前講義で試したサンプル
http://code.google.com/p/rtm-ros-robotics/wiki/RTM_Example
を試す.
{{{
roslaunch openrtm MobileRobot_2DSimulator_Example.launch
}}}
http://code.google.com/p/rtm-ros-robotics/wiki/RTM_2DSimulator_Example
にあるように，「TkMobileRobotSimulator.py」が起動したら,「Create」ボタンを一回押す． 

他に
{{{
roslaunch openrtm Slider_and_Motor_Example.launch
roslaunch openrtm Seq_Example.launch
}}}
がある。

[http://rtm-ros-robotics.googlecode.com/svn/wiki/MobileRobot_2DSimulator_Example.png]
[http://rtm-ros-robotics.googlecode.com/svn/wiki/Slider_and_Motor_Example.png]
[http://rtm-ros-robotics.googlecode.com/svn/wiki/Seq_Example.png]

== GRXUI 動作確認 ==
{{{
roslaunch mrobot_ros_bridge mrobot_simulator.launch 
}}}
として、視点を下に移すと台車ロボットが見えればOK.

== モデルが表示されないときは... ==

* "LoadProject"で"FallingBoxes"を選択しても3DViewにモデルがでない。
{{{
roscd openhrp3; bin/openhrp-model-loader 
}}}
として
{{{
ready
}}}
がでているか確認。でていない場合は、
{{{
$ sudo /etc/init.d/omniorb4-nameserver stop
$ pkill -KILL omniNames
$ rtm-naming
}}}
とする．10.04の人は/etc/hostsの::1から始まる行がコメントアウトされているか再確認．

* "FallingBoxes"のシミュレーションは表示されるけど、"SampleRobot_inHouse.xml"をロードしてもロボットが表示されない場合、
{{{
$ sudo rm /usr/lib/eclipse/plugins/com.generalrobotix.ui.grxui_0.9.8.jar
$ roscd openhrp3; rm installed
$ make
}}}